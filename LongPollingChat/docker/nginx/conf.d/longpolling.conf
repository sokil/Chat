server
{
    listen 80;
    server_name longpolling;

    root /var/www/longpolling/public;

    # Shows channel statistics
    location /stat
    {
        push_stream_channels_statistics;

        # configure channels path from argument in query string, e.g. /stat?channel=general
        push_stream_channels_path $arg_channel;
    }

    # Route used to connect and wait new messages.
    # If new messages received, current connection closed and new one opens.
    location /subscribe
    {
        # declare subscriber route
        push_stream_subscriber long-polling;

        # configure channels path from argument in query string, e.g. /subscribe?channel=general
        push_stream_channels_path $arg_channel;

        push_stream_longpolling_connection_ttl 20s;
    }

    # Route used to mublish message to all subscribed clients.
    # Subscription identified by channel, specified in "push_stream_channels_path"
    location /publish
    {
        # declare publisher route
        push_stream_publisher admin;

        # configure channels path from argument in query string, e.g. /publish?channel=general
        push_stream_channels_path $arg_channel;
    }

    location /
    {
        try_files $uri @rewrite;
    }

    location @rewrite
    {
        rewrite ^/(.*)$ /bootstrap.php;
    }

    location ~ \.php
    {
        try_files $uri @rewrite;

        fastcgi_pass php:9000;

        include /etc/nginx/fastcgi_params;
        fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
    }
}
